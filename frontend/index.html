<form id="upload-form">
  <label>Select image to upload:</label>
  <input type="file" id="imageInput" name="image" required />

  <label>Width (optional):</label>
  <input type="number" id="widthInput" name="width" placeholder="e.g. 200" />

  <label>Height (optional):</label>
  <input type="number" id="heightInput" name="height" placeholder="e.g. 200" />

  <button type="submit">Upload and Resize</button>
</form>

<script>
  const form = document.getElementById('upload-form');
  const output = document.getElementById('output');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const fileInput = document.getElementById('imageInput');
    const widthInput = document.getElementById('widthInput');
    const heightInput = document.getElementById('heightInput');

    const formData = new FormData();
    formData.append('image', fileInput.files[0]);
    if (widthInput.value) formData.append('width', widthInput.value);
    if (heightInput.value) formData.append('height', heightInput.value);

    try {
      const uploadRes = await fetch('/upload', {
        method: 'POST',
        body: formData
      });

      if (!uploadRes.ok) throw new Error('Upload failed');

      const uploadData = await uploadRes.json();
      const filename = uploadData.filename;

      // Build query
      const params = new URLSearchParams();
      if (widthInput.value) params.append('width', widthInput.value);
      if (heightInput.value) params.append('height', heightInput.value);

      const imageUrl = `/uploads/${filename}`;
      output.innerHTML = `<h3>Processed Image:</h3><img src="${imageUrl}" alt="Processed image" />`;

    } catch (err) {
      console.error(err);
      output.innerHTML = `<p style="color:red;">${err.message}</p>`;
    }
  });
</script>
